---
title: "Path Analysis Data Development - Chapter 2"
author: "Whalen Dillon"
date: "June 15, 2015"
output: 
  html_document:
    toc: true
---

## Load data
```{r pairs helper functions, echo=FALSE}
panel.hist <- function(x, ...)
{
      usr <- par("usr"); on.exit(par(usr))
      par(usr = c(usr[1:2], 0, 1.5) )
      h <- hist(x, plot = FALSE)
      breaks <- h$breaks; nB <- length(breaks)
      y <- h$counts; y <- y/max(y)
      rect(breaks[-nB], 0, breaks[-1], y, col = "cyan", ...)
}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
      usr <- par("usr"); on.exit(par(usr))
      par(usr = c(0, 1, 0, 1))
      r <- abs(cor(x, y, use = "na.or.complete"))
      txt <- format(c(r, 0.123456789), digits = digits)[1]
      txt <- paste0(prefix, txt)
      if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
      text(0.5, 0.5, txt, cex = cex.cor * r)
}
```
```{r load ecological data, echo=FALSE}
# Ecological data: leaf counts, infection
load("~/GitHub/superspreaders/stems_plots.RData")
stems <- read.csv("analysis/data/tagged-stems-corrected.csv")

# Vegetation transect data
veg_us_2005 <- read.csv("analysis/data/understory_veg_2005.csv")
veg_us_2011 <- read.csv("analysis/data/understory_veg_2011.csv")

# Untagged dbh data
untagged_dbh_2005 <- read.csv("analysis/data/untagged_dbh2005_summary.csv")
untagged_dbh_2014 <- read.csv("analysis/data/untagged_dbh2014_summary.csv")
canopy_cover <- read.csv("analysis/data/plot_canopy_cover_dens.csv")
```
```{r load physical data, echo=FALSE, message=F}
# Physical environment: topography
library(rgdal); library(plyr); library(dplyr)
plots_shp <- readOGR("analysis/data/plot_gis/", "soco_plots_metric")
plots_env <- plots_shp@data
summary(plots_env)
plots_env <- select(plots_env, -cat, -X, -Y)

# Elevation and vegetation height are in feet, slope is degrees, and canopy density is the proportion of the cell covered by canopy (0-1)
plots_topo.shp <- readOGR("analysis/data/plot_gis/", "plots202_vegtopo")
plots_vegtopo <- plots_topo.shp@data
summary(plots_vegtopo)
plots_vegtopo <- select(plots_vegtopo, -cat) %>% rename(lon_utm = X, lat_utm = Y)
```
```{r load weather data, echo=FALSE}
# Temperature: rainy season hour summaries (long format for each year)
rs_temps <- read.csv("analysis/data/rs_select_temps.csv")
summary(rs_temps)
rs_temps <- select(rs_temps, -X)

summer_temps <- read.csv("analysis/data/summer_select_temps.csv")
summary(summer_temps)
summer_temps <- select(summer_temps, -X)

# Rainfall: interpolated/estimated rainfall for each season
load("~/Documents/soco_ppt/plot_ppt_estimates.RData")
summary(ppt_days)
summary(ppt_total)
# plots_rain <- read.csv("analysis/data/plot202rain.csv")
# summary(plots_rain)
# plots_rain <- select(plots_rain, -cat)
# pairs(select(plots_rain, -PLOT_ID), 
#       lower.panel = panel.cor, 
#       diag.panel = panel.hist)
ppt_days@data <- rename(ppt_days@data, plotid = PLOT_ID)
ppt_total@data <- rename(ppt_total@data, plotid = PLOT_ID)
```

## Join remotely sensed and derived physical data
LiDAR products, variables derived from DEMs
```{r join remotely sensed data}
plots_env <- inner_join(plots_env, plots_vegtopo, by = "PLOT_ID")
summary(plots_env)
plots_env$elev_m <- plots_env$elev15m * .3048
# plots_env <- select(plots_env, -elevation, -tmi) #remove elevation, tmi from old derivation (I think a legacy 10m USGS DEM)
plots_env$veght_m <- plots_env$veght15m * .3048
rm(plots_vegtopo)
```

## Convert rain data from wide to long
```{r rain wide to long}
library(tidyr)
rain2d_total <- ppt_total@data %>% select(plotid, ends_with("2d"))
names(rain2d_total) <- c("plotid",paste(c(2004:2012,2014), sep = ","))
rain2d_total <- rain2d_total %>% gather(year, rain_tot_2d, -plotid)

rain3d_total <- ppt_total@data %>% select(plotid, ends_with("3d"))
names(rain3d_total) <- c("plotid",paste(c(2004:2012,2014), sep = ","))
rain3d_total <- rain3d_total %>% gather(year, rain_tot_3d, -plotid)

rain_v_total <- ppt_total@data %>% select(plotid, ends_with("v"))
names(rain_v_total) <- c("plotid",paste(c(2004:2012,2014), sep = ","))
rain_v_total <- rain_v_total %>% gather(year, rain_tot_v, -plotid)

rain_r_total <- ppt_total@data %>% select(plotid, ends_with("r"))
names(rain_r_total) <- c("plotid",paste(c(2004:2012,2014), sep = ","))
rain_r_total <- rain_r_total %>% gather(year, rain_tot_r, -plotid)

rain_psm_total <- ppt_total@data %>% select(plotid, contains("sum"))
names(rain_psm_total) <- c("plotid", paste(c(2004:2010), sep = ","))
rain_psm_total <- rain_psm_total %>% gather(year, rain_tot_psm, -plotid)


rain2d_days <- ppt_days@data %>% select(plotid, ends_with("2d"))
names(rain2d_days) <- c("plotid",paste(c(2004:2012,2014), sep = ","))
rain2d_days <- rain2d_days %>% gather(year, rain_days_2d, -plotid)

rain3d_days <- ppt_days@data %>% select(plotid, ends_with("3d"))
names(rain3d_days) <- c("plotid",paste(c(2004:2012,2014), sep = ","))
rain3d_days <- rain3d_days %>% gather(year, rain_days_3d, -plotid)

rain_v_days <- ppt_days@data %>% select(plotid, ends_with("v"))
names(rain_v_days) <- c("plotid",paste(c(2004:2012,2014), sep = ","))
rain_v_days <- rain_v_days %>% gather(year, rain_days_v, -plotid)

rain_r_days <- ppt_days@data %>% select(plotid, ends_with("r"))
names(rain_r_days) <- c("plotid",paste(c(2004:2012,2014), sep = ","))
rain_r_days <- rain_r_days %>% gather(year, rain_days_r, -plotid)


rain_total <- left_join(rain2d_total, 
                        left_join(rain3d_total, rain_v_total, 
                                  by = c("plotid","year")),
                        by = c("plotid","year"))
rain_total <- left_join(rain_total, rain_r_total, by = c("plotid", "year"))
rain_total <- left_join(rain_total, rain_psm_total, by = c("plotid", "year"))
summary(rain_total)# NAs are due to current PRISM data only going through 2010
unique(rain_total$plotid)# 202 plots
unique(rain_total$year)# 10 sampling seasons

rain_days <- left_join(rain2d_days,
                       left_join(rain3d_days, rain_v_days, 
                                 by = c("plotid", "year")),
                       by = c("plotid", "year"))
rain_days <- left_join(rain_days, rain_r_days, by = c("plotid", "year"))
summary(rain_days)
unique(rain_days$plotid)# 202 plots
unique(rain_days$year)# 10 sampling seasons

rm(list = ls(pattern = "^rain_v"))
rm(list = ls(pattern = "^rain2d"))
rm(list = ls(pattern = "^rain3d"))
rm(list = ls(pattern = "^rain_r"))
rm(rain_psm_total)

write.csv(rain_total, "analysis/data/rain_total_long.csv", row.names = F)
write.csv(rain_days, "analysis/data/rain_days_long.csv", row.names = F)
```

## Explore data for completeness and matching
```{r explore plot_env data, message=FALSE}
summary(plots_env)
str(plots_env)
plots_env <- plots_env %>% rename(plotid = PLOT_ID)

write.csv(plots_env, "analysis/data/env_gis_variables.csv", row.names = F)
# plots_env <- read.csv("analysis/data/env_gis_variables.csv")
```

Examine temperature data, which is in long format and covers sample years 2004 through 2014. This means that I will need to exclude disease-related sampling from 2003 of the ecological data (NAs should fill-in if missing data when joining).
```{r examine temperature & rain data}
# Temperature Data
summary(rs_temps)
summary(summer_temps)

# Rainfall Data
summary(ppt_days)
summary(ppt_total)
rain_df <- merge(ppt_days@data, ppt_total@data)
summary(rain_df)

unique(rs_temps$plotid)# 201 plots
unique(summer_temps$plotid)# 201 plots
unique(rain_df$plotid)# 202 plots

tempsid <- as.character(unique(rs_temps$plotid))
rainid <- as.character(unique(rain_df$plotid))
rainid %in% tempsid
rainid[62]# BUSH01 still in the rain data
rain_df <- filter(rain_df, plotid != "BUSH01")

# Temperature and rainfall data now have same number of observations
rm(tempsid); rm(rainid)
```

## Investigating `NAs` in the `plots_temps` data set
A number of observations for above 25 threshold have NAs. I believe that these are in fact truly zero observations. NAs occurred for the 2010, 2011, and 2014 seasons, and the only NAs in the data set are associated with the above 25 threshold. I do believe that it is possible that the temperature was never above 25 C during the wet season November - May in some years.
```{r investigate NAs, eval=FALSE, echo=FALSE}
# summary(plots_env)
# filter(plots_env, plotid == "BUSH01")

# BUSH01 plot included. I think we have limited ecological data for this plot, and no microclimate data. So, I am going to exclude it from all the data sets
# plots_env <- filter(plots_env, plotid != "BUSH01")
stems <- as.tbl(stems)
stems
# stems <- select(stems, -X) 
unique(filter(stems, plot_status == "Abandoned")$plotid)
stems <- stems %>% filter(plotid != "bush01", plotid != "ponti01", 
                                plotid != "sweet01")
stems$plotid <- droplevels(stems$plotid)

rs_temps %>% filter(is.na(hrs_abv25))
# I am replacing the NAs with 0, assuming true observations, i.e. there were zero hours where temperatures were above 25C
rs_temps[is.na(rs_temps)] <- 0
```

### Save data with BUSH01 excluded
```{r save data}
write.csv(plots_env, "analysis/data/env_gis_variables.csv", row.names = F)
write.csv(rain_df, "analysis/data/rain_data_long.csv", row.names = F)
write.csv(rs_temps, "analysis/data/rs_temps_data.csv", row.names = F)
write.csv(summer_temps, "analysis/data/summer_temps_data.csv", row.names = F)
# write.csv(stems, "analysis/data/stems_noBUSH01.csv", row.names = F)
# rm(plots_temps); rm(plots_rain)
```

## Starting Point with Revised Data: Reload data that has BUSH01 excluded
Still need to load the .RData source at the beginning of this document, line 32.
```{r reload data}
plots_env <- read.csv("analysis/data/env_gis_variables.csv")
rain_df <- read.csv("analysis/data/rain_data_long.csv")
rs_temps <- read.csv("analysis/data/rs_temps_data.csv")
summer_temps <- read.csv("analysis/data/summer_temps_data.csv")
# stems <- read.csv("analysis/data/stems_noBUSH01.csv")
```


## Examine the bay laurel data at individual and plot levels
```{r examine umca data}
bay_laurel <- filter(stems, species == "umca") %>% 
      select(plotid, cluster:stem_status, umca_slc, notes:dbh_entry)
bay_laurel$species <- droplevels(bay_laurel$species)
summary(bay_laurel) # This has stem-level data on bay laurel.
length(unique(bay_laurel$plotid))# 183 plots with bay laurel
# bay_laurel <- filter(bay_laurel, plot != "BUSH01")

# Data frame of UMCA plots only
umca_plots <- bay_laurel %>%
      # select(plotid, date, species, umca_slc, year, stem_status) %>%
      group_by(plotid, year, species) %>%
      filter(species == "umca", stem_status == "Alive") %>%
      summarise(uninfected_bay_ct = length(which(umca_slc == 0)), 
                infected_bay_ct = length(which(umca_slc > 0)), 
                tot_bay = length(species)) 
summary(umca_plots)

# length(unique(umca_plots$plotid))# 183 plots with bay laurel
# umca_plots <- filter(plots_umca, plot != "BUSH01")
rm(plots_umca)
```

I can use the stem-level data to calculate plot level leaf count variables (sum, average) for each plot and year.
```{r calculate plot level leaf counts}
live_umca <- bay_laurel %>% filter(stem_status == "Alive")
filter(live_umca, is.na(umca_slc))
# Spot checking some of these shows that NAs are reasonable
umca_plots <- left_join(
      umca_plots, 
      live_umca %>% 
            group_by(plotid, year) %>% 
            summarise(avg_lfct = mean(umca_slc, na.rm = T),
                      tot_lfct = sum(umca_slc, na.rm = T)),
      by = c("plotid", "year"))
summary(umca_plots)
```

Explore the NAs in the UMCA leaf counts.
```{r examine lfct NAs}
filter(umca_plots, is.na(avg_lfct))
filter(bay_laurel, plotid == "yahng02", stem_status == "Alive")
# I'm not sure why this wasn't excluded from the calculations with the na.rm = T option
# I'm removing it manually from the `umca_plots` data frame
umca_plots <- umca_plots %>% filter(avg_lfct != "NaN")
summary(umca_plots)
```


So now I have a plot-level data frame of UMCA infection for each year in terms of symptomatic leaf counts and number of un/infected stems. I want to join this with some of the plot-level environmental data.
```{r join env and umca data}
summary(plots_env)
plots_env$plotid <- tolower(plots_env$plotid)

# Calculate a mean potential solar radiation
plots_env$avg_psi <- rowMeans(
      cbind(plots_env$psiSpr, plots_env$psiSum, plots_env$psiWin))
summary(umca_plots)
# plot == plotid, year == sample_year

# Join the environmental data to the bay laurel infection data
umca_plots <- left_join(select(umca_plots, -species), plots_env, by = "plotid")
summary(umca_plots)
# filter(umca_plots, is.na(lon_utm))
# NAs due to no topo data for abandoned SUGAR02; remove SUGAR02
# umca_plots <- na.omit(umca_plots)
umca_plots <- rename(umca_plots, sample_year = year)
# umca_plots$plotid <- tolower(umca_plots$plotid)

# Join rainy season and summer temperatures to bay laurel infection data.
## I need to rename temperature variables to differentiate rainy vs. dry season
rs_temps <- as.tbl(rs_temps)
rs_temps$plotid <- tolower(rs_temps$plotid)
summary(rs_temps)
rs_temps <- rename(rs_temps, 
                   hrs_14_20_rs = hrs_14_20, hrs_abv25rs = hrs_abv25,
                   hrs_abv20_rs = hrs_abv20, hrs_blw10rs = hrs_blw10,
                   avg_tmax_rs = avg_tmax, avg_tmin_rs = avg_tmin)

summer_temps <- as.tbl(summer_temps)
summer_temps$plotid <- tolower(summer_temps$plotid)
summary(summer_temps)
summer_temps <- rename(summer_temps, 
                       hrs_abv25ds = hrs_abv25, hrs_abv20ds = hrs_abv20,
                       hrs_blw18ds = hrs_blw18, avg_tmax_ds = avg_tmax,
                       avg_tmin_ds = avg_tmin)

# Now I can join the data without duplicating variable names
umca_plots <- left_join(umca_plots, rs_temps, by = c("plotid", "sample_year"))
umca_plots <- left_join(umca_plots, summer_temps, by = c("plotid", "sample_year"))
summary(umca_plots)# 7 NAs introduced into the temperature variables
filter(umca_plots, is.na(avg_tmax_rs))# NAs due to records from 2003
## I don't think these will end up in my analysis, but no reason to remove them at this time.

# Add rainfall data to UMCA plots data frame
summary(rain_total)
unique(rain_total$plotid)
rain_total$plotid <- tolower(rain_total$plotid)
summary(rain_days)
unique(rain_days$plotid)
rain_days$plotid <- tolower(rain_days$plotid)

rain_total <- rename(rain_total, sample_year = year)
rain_total$sample_year <- as.character(rain_total$sample_year)
rain_days <- rename(rain_days, sample_year = year)
rain_days$sample_year <- as.character(rain_days$sample_year)

summary(umca_plots)
umca_plots$sample_year <- as.character(umca_plots$sample_year)
umca_plots <- left_join(umca_plots, rain_total, by = c("plotid", "sample_year"))
umca_plots <- left_join(umca_plots, rain_days, by = c("plotid", "sample_year"))
summary(umca_plots)

filter(umca_plots, is.na(rain_tot_2d))
# Same case of NAs in rainfall due to data from 2003
```

## Load and Join Richness, Diversity, Evenness Data
Now I want to join the richness data set and the canopy cover estimates to the `umca_plots` data frame that currently has the environmental and leaf count/infection variables. 

```{r join richness and umca data}
os.us.diversity <- as.tbl(read.csv("analysis/data/os_us_diversity.csv"))
summary(os.us.diversity)
# variables prefixed with 'us' indicate understory metrics
umca_plots

umca_plots <- left_join(umca_plots, os.us.diversity, by = c("plotid"))
summary(umca_plots)
filter(umca_plots, is.na(H.2014))$plotid
## NAs due to plots abandoned/lost between 2005 and 2014; 4 unique plots
filter(umca_plots, is.na(us.H.2005))
## NAs due to plot having '0' for understory richness
filter(umca_plots, is.na(us.H.2011))
## NAs due to 2 plots being abaondoned prior to 2011 & one plot having '0' for understory richness

head(canopy_cover)
canopy_cover <- select(canopy_cover, -X)
canopy_cover <- rename(canopy_cover, sample_year = year)
summary(canopy_cover)
unique(filter(canopy_cover, sample_year == 2006)$plotid)
canopy_cover$sample_year <- as.character(canopy_cover$sample_year)

umca_plots <- left_join(umca_plots, canopy_cover, by = c("plotid", "sample_year"))
summary(umca_plots)# NAs because canopy cover was not measured every year
```

Make a pairs plot of the continuous variables for UMCA plots.
```{r umca sod pairs plot}
# Helper functions for `pairs`
panel.hist <- function(x, ...)
{
      usr <- par("usr"); on.exit(par(usr))
      par(usr = c(usr[1:2], 0, 1.5) )
      h <- hist(x, plot = FALSE)
      breaks <- h$breaks; nB <- length(breaks)
      y <- h$counts; y <- y/max(y)
      rect(breaks[-nB], 0, breaks[-1], y, col = "cyan", ...)
}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
      usr <- par("usr"); on.exit(par(usr))
      par(usr = c(0, 1, 0, 1))
      r <- abs(cor(x, y, use = "na.or.complete"))
      txt <- format(c(r, 0.123456789), digits = digits)[1]
      txt <- paste0(prefix, txt)
      if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
      text(0.5, 0.5, txt, cex = cex.cor * r)
}

umca_plots <- ungroup(umca_plots)

pairs(select(umca_plots, candens15m, pct_cvr, veght15m), 
      lower.panel = panel.cor, diag.panel = panel.hist, 
      main = "Canopy Data - UMCA Plots")
cor(umca_plots$candens15m, umca_plots$pct_cvr, use = "complete.obs")
cor(umca_plots$veght15m, umca_plots$pct_cvr, use = "complete.obs")

pairs(na.omit(select(umca_plots, avg_lfct, tot_lfct, contains("hrs"), contains("rain_tot"), H.2005, H.2014)),
      lower.panel = panel.cor, diag.panel = panel.hist, 
      main = "Leaf Count, Temperature, Rainfall, Diversity - UMCA Plots")
## Rainfall and temperature all have fairly weak correlations (<0.36)
## The diversity metrics are the only correlates with leaf count >0.20
```

Now that I have summarized some vegetation (not species specific), environmental, and bay laurel disease data to the plot-level I want to join this and the canopy cover data to the plot-level oak infection data.

```{r join umca and qusp data}
umca_plots
umca_plots$sample_year <- as.integer(umca_plots$sample_year)
plot_qusp # right now this is broken down by oak species
qusp4_plots <- stems %>%
      select(plotid, date, species, canker, year, stem_status) %>%
      filter(species == "quag" | species == "quke" | species == "quch" |
                   species == "quwi", stem_status == "Alive") %>% 
      group_by(plotid, year, species) %>% 
      summarise(uninfected_oak_ct = length(which(canker==0)), 
                infected_oak_ct = length(which(canker > 0)), 
                tot_oak = length(species))

# rm(plot_qusp)
summary(qusp4_plots)

oak_sod <- qusp4_plots %>% group_by(plotid, year) %>%
      summarise(uninf_oak_ct = sum(uninfected_oak_ct), 
                inf_oak_ct = sum(infected_oak_ct), 
                tot_oak_ct = sum(c(uninfected_oak_ct, infected_oak_ct)))
oak_sod
oak_sod <- rename(oak_sod, sample_year = year)
# oak_sod$plotid <- tolower(oak_sod$plotid)

# unique(umca_plots$plotid) %in% unique(oak_sod$plotid)

# Add bay laurel infection data to oak plots
names(umca_plots)
oak_sod <- left_join(oak_sod, 
                     select(umca_plots, plotid, sample_year, uninfected_bay_ct, infected_bay_ct, tot_bay, avg_lfct, tot_lfct), 
                     by = c("plotid", "sample_year"))
summary(oak_sod) # the NA's for the bay laurel variables are legitimately zeroes b/c there are no bay in some of these plots
filter(oak_sod, is.na(tot_bay), sample_year != 2003)
# Change NAs of bay laurel in oak only plots to zeroes
oak_sod$uninfected_bay_ct[is.na(oak_sod$uninfected_bay_ct)] <- 0
oak_sod$infected_bay_ct[is.na(oak_sod$infected_bay_ct)] <- 0
oak_sod$tot_bay[is.na(oak_sod$tot_bay)] <- 0

# Add environmental data to oak plot infection data.
plots_env
plots_env$plotid <- tolower(plots_env$plotid)
oak_sod <- left_join(oak_sod, plots_env, by = "plotid")# Topo data 

rs_temps
summer_temps
oak_sod <- left_join(oak_sod, rs_temps, by = c("plotid", "sample_year"))
oak_sod <- left_join(oak_sod, summer_temps, by = c("plotid", "sample_year"))
oak_sod
names(oak_sod)

os.us.diversity
oak_sod <- left_join(oak_sod, os.us.diversity, by = c("plotid"))
summary(oak_sod)
filter(oak_sod, is.na(avg_tmax_rs))# NAs are plots sampled in 2003
filter(oak_sod, is.na(H.2014))# NAs are plots lost before 2014
summary(filter(oak_sod, is.na(us.J.2011)))# zero or missing data for understory richness
# oak_sod <- filter(oak_sod, plotid != "duer01", plotid != "ponti01", plotid != "sweet01")

oak_sod <- filter(oak_sod, sample_year != 2003)
filter(oak_sod, is.na(avg_tmax_rs))
# BUSH01 plot; I'm dropping that from the data set
# oak_sod <- filter(oak_sod, plotid != "bush01")
summary(oak_sod)

filter(oak_sod, is.na(H.2014))$plotid
## plots that were decommissioned prior to 2014
filter(oak_sod, is.na(us.H.2011))$plotid
## plots that have legit 0 for richness or were decommissioned prior to 2011

canopy_cover$sample_year <- as.integer(canopy_cover$sample_year)
oak_sod <- left_join(oak_sod, canopy_cover, by = c("plotid", "sample_year"))

summary(rain_total)
rain_total$sample_year <- as.integer(rain_total$sample_year)

summary(rain_days)
rain_days$sample_year <- as.integer(rain_days$sample_year)


oak_sod <- left_join(oak_sod, rain_total, by = c("plotid", "sample_year"))
oak_sod <- left_join(oak_sod, rain_days, by = c("plotid", "sample_year"))
summary(oak_sod)

summary(filter(oak_sod, is.na(rain_tot_psm))) # all obs after 2010
summary(filter(oak_sod, is.na(us.J.2011)))
filter(oak_sod, is.na(us.J.2011))$plotid# ann06, mroth03, sumtv02
# ann06 & mroth03 are legitimate zeroes for understory richness in 2011
# sumtv02 was abandoned after 2008, so it should be an NA for later years


filter(oak_sod, sample_year == 2004) # 88 records
# 2005 appears to be the first full year of observing all the plots
filter(oak_sod, sample_year == 2005) # 165 records
filter(oak_sod, sample_year == 2006) # 167 records
filter(oak_sod, sample_year == 2007) # 164 records
filter(oak_sod, sample_year == 2008) # 163 records
filter(oak_sod, sample_year == 2009) # 162 records
filter(oak_sod, sample_year == 2010) # 161 records
filter(oak_sod, sample_year == 2011) # 159 records; final year for Sarah's 2nd chapter
filter(oak_sod, sample_year == 2012) # 156 records
filter(oak_sod, sample_year == 2014) # 156 records
# In Sarah's analysis we end up using 163 plots
```


Now to do a pairs plot of the variables from the `oak_sod` data frame.

```{r oak_sod pairs plot}
class(oak_sod)
oak_sod <- ungroup(oak_sod)
summary(oak_sod)
# drop rainy days interpolations, they aren't reliable; keep voronoi neighbor method
oak_sod <- select(oak_sod, -rain_days_2d, -rain_days_3d, -rain_days_r)
pairs(select(oak_sod, elev_m, starts_with("hrs"), starts_with("avg_t"), contains("rain_tot")), lower.panel = panel.cor, diag.panel = panel.hist, main = "Oak-SOD Rainfall & Temperature Data")

pairs(na.omit(select(oak_sod, c(3:4,7:8,9:10), H.2005, H.2014)),
      lower.panel = panel.cor, diag.panel = panel.hist, 
      main = "Oak-SOD Infection & Diversity Data")
```

### Save path analysis data environment
```{r save data environment}
# save.image("~/GitHub/superspreaders/pathmodel_data_20160112.RData")
```

### Update path analysis data
Updating the path analysis data with the temperature during wet days variables.
```{r update data}
# load("pathmodel_data_20160112.RData")
wet_hrs <- read.csv("analysis/data/wet-days-temperature-variables.csv")
save.image("~/GitHub/superspreaders/pathmodel_data.RData")
```



